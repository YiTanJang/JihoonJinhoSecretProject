#pragma once
#include <vector>
#include <algorithm>
#include <cmath>

namespace PhysicsLookup {
    struct DataPoint {
        double bad_ar;
        double temp;
    };

    // Data from physics_logs_20260131_200036
    // Sorted by Bad AR descending
    static const std::vector<DataPoint> lookup_table = {
        {0.7921, 288.00}, {0.7875, 279.19}, {0.7825, 270.53}, {0.7759, 262.15},
        {0.7696, 254.02}, {0.7645, 246.14}, {0.7568, 238.51}, {0.7503, 231.11},
        {0.7436, 223.94}, {0.7376, 217.00}, {0.7304, 210.27}, {0.7245, 203.75},
        {0.7173, 197.43}, {0.7112, 191.31}, {0.7021, 185.38}, {0.6977, 179.63},
        {0.6890, 174.06}, {0.6817, 168.66}, {0.6732, 163.43}, {0.6654, 158.36},
        {0.6585, 153.45}, {0.6496, 148.70}, {0.6414, 144.08}, {0.6336, 139.62},
        {0.6242, 135.29}, {0.6166, 131.09}, {0.6072, 127.03}, {0.5988, 123.09},
        {0.5900, 119.27}, {0.5821, 115.57}, {0.5725, 111.99}, {0.5651, 108.52},
        {0.5533, 105.15}, {0.5471, 101.89}, {0.5372, 98.73},  {0.5278, 95.67},
        {0.5188, 92.70},  {0.5100, 89.83},  {0.5001, 87.04},  {0.4914, 84.34},
        {0.4830, 81.73},  {0.4720, 79.19},  {0.4641, 76.74},  {0.4552, 74.36},
        {0.4458, 72.05},  {0.4360, 69.82},  {0.4274, 67.65},  {0.4184, 65.56},
        {0.4081, 63.52},  {0.3988, 61.55},  {0.3905, 59.64},  {0.3815, 57.79},
        {0.3732, 56.00},  {0.3648, 54.27},  {0.3548, 52.58},  {0.3465, 50.95},
        {0.3383, 49.37},  {0.3299, 47.84},  {0.3220, 46.36},  {0.3145, 44.92},
        {0.3062, 43.53},  {0.2971, 42.18},  {0.2903, 40.87},  {0.2824, 39.60},
        {0.2751, 38.37},  {0.2682, 37.18},  {0.2600, 36.05},  {0.2527, 34.95},
        {0.2468, 33.86},  {0.2396, 32.81},  {0.2334, 31.79},  {0.2267, 30.81},
        {0.2203, 29.85},  {0.2135, 28.93},  {0.2086, 28.03},  {0.2021, 27.16},
        {0.1965, 26.32},  {0.1912, 25.50},  {0.1856, 24.71},  {0.1796, 23.95},
        {0.1755, 23.20},  {0.1701, 22.48},  {0.1642, 21.79},  {0.1601, 21.11},
        {0.1547, 20.46},  {0.1514, 19.82},  {0.1471, 19.21},  {0.1421, 18.61},
        {0.1380, 18.03},  {0.1345, 17.48},  {0.1301, 16.93},  {0.1268, 16.41},
        {0.1233, 15.90},  {0.1195, 15.41},  {0.1157, 14.93},  {0.1126, 14.47},
        {0.1085, 14.02},  {0.1065, 13.58},  {0.1036, 13.16},  {0.0999, 12.75},
        {0.0974, 12.36},  {0.0946, 11.97},  {0.0922, 11.60},  {0.0898, 11.24},
        {0.0876, 10.89},  {0.0838, 10.56},  {0.0820, 10.23},  {0.0789, 9.91},
        {0.0772, 9.61},   {0.0754, 9.31},   {0.0730, 9.02},   {0.0707, 8.74},
        {0.0689, 8.47},   {0.0675, 8.21},   {0.0656, 7.95},   {0.0633, 7.70},
        {0.0619, 7.47},   {0.0605, 7.23},   {0.0587, 7.01},   {0.0575, 6.79},
        {0.0549, 6.58},   {0.0539, 6.38},   {0.0523, 6.18},   {0.0514, 5.99},
        {0.0507, 5.80},   {0.0489, 5.62},   {0.0476, 5.45},   {0.0471, 5.28},
        {0.0447, 5.12},   {0.0436, 4.96},   {0.0431, 4.80},   {0.0430, 4.65},
        {0.0412, 4.51},   {0.0397, 4.37},   {0.0386, 4.24},   {0.0368, 4.11},
        {0.0373, 3.98},   {0.0367, 3.86},   {0.0357, 3.74},   {0.0349, 3.62},
        {0.0344, 3.51},   {0.0331, 3.40},   {0.0327, 3.29},   {0.0318, 3.19},
        {0.0310, 3.09},   {0.0304, 3.00},   {0.0295, 2.90},   {0.0285, 2.81},
        {0.0281, 2.73},   {0.0280, 2.64},   {0.0268, 2.56},   {0.0261, 2.48},
        {0.0264, 2.40},   {0.0259, 2.33},   {0.0243, 2.26},   {0.0237, 2.19},
        {0.0238, 2.12},   {0.0236, 2.05},   {0.0230, 1.99},   {0.0224, 1.93},
        {0.0213, 1.87},   {0.0218, 1.81},   {0.0218, 1.75},   {0.0202, 1.70},
        {0.0196, 1.65},   {0.0190, 1.60},   {0.0185, 1.55},   {0.0178, 1.50},
        {0.0182, 1.45},   {0.0183, 1.41},   {0.0173, 1.36},   {0.0165, 1.32},
        {0.0164, 1.28},   {0.0161, 1.24},   {0.0166, 1.20},   {0.0158, 1.17},
        {0.0153, 1.13},   {0.0145, 1.09},   {0.0144, 1.06},   {0.0140, 1.03},
        {0.0135, 1.00},   {0.0136, 0.96},   {0.0133, 0.93},   {0.0127, 0.91},
        {0.0127, 0.88},   {0.0127, 0.85},   {0.0124, 0.82},   {0.0123, 0.80},
        {0.0123, 0.77},   {0.0119, 0.75},   {0.0121, 0.73},   {0.0121, 0.70},
        {0.0121, 0.68},   {0.0118, 0.66},   {0.0114, 0.64},   {0.0115, 0.62},
        {0.0115, 0.60},   {0.0109, 0.58},   {0.0112, 0.57}
    };

    inline double get_temp_for_bad_ar(double target_bad_ar) {
        // Handle out of bounds
        if (target_bad_ar >= lookup_table.front().bad_ar) return lookup_table.front().temp;
        if (target_bad_ar <= lookup_table.back().bad_ar) return lookup_table.back().temp;

        // Linear Interpolation
        for (size_t i = 0; i < lookup_table.size() - 1; ++i) {
            const auto& p1 = lookup_table[i];
            const auto& p2 = lookup_table[i + 1];

            // Because table is sorted descending by Bad AR
            if (target_bad_ar <= p1.bad_ar && target_bad_ar > p2.bad_ar) {
                double t = (target_bad_ar - p2.bad_ar) / (p1.bad_ar - p2.bad_ar);
                return p2.temp + t * (p1.temp - p2.temp);
            }
        }
        return lookup_table.back().temp;
    }
}
